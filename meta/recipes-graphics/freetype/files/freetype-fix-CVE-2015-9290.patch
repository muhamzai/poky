From 15afce0e25d5e92f217a2d341d1157220fb5606c Mon Sep 17 00:00:00 2001
From: Muhammad Hamza <muhammad_hamza@mentor.com>
Date: Mon, 7 Dec 2020 16:15:53 +0500
Subject: [PATCH] From e3058617f384cb6709f3878f753fa17aca9e3a30 Mon Sep 17
 00:00:00 2001 From: Werner Lemberg <wl@gnu.org> Date: Sun, 13 Sep 2015
 08:41:43 +0200 Subject: [type1] Fix potential buffer overflow (#45923).

* src/type1/t1parse.c (T1_Get_Private_Dict): Assure `cur' doesn't
point to end of file buffer.

UpStream-Status: Backport From
http://git.savannah.gnu.org/cgit/freetype/freetype2.git/commit/src
/type1/t1parse.c?id=e3058617f384cb6709f3878f753fa17aca9e3a30

CVE: CVE-2015-9290

Signed-off-by: Muhammad Hamza <muhammad_hamza@mentor.com>
---
 src/type1/t1parse.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/type1/t1parse.c b/src/type1/t1parse.c
index c73b2b2..d8d4df2 100644
--- a/src/type1/t1parse.c
+++ b/src/type1/t1parse.c
@@ -389,6 +389,15 @@
 
       cur   = limit;
       limit = parser->base_dict + parser->base_len;
+
+      if ( cur >= limit )
+      {
+        FT_ERROR(( "T1_Get_Private_Dict:"
+                   " premature end in private dictionary\n" ));
+        error = FT_THROW( Invalid_File_Format );
+        goto Exit;
+      }
+
       goto Again;
 
       /* now determine where to write the _encrypted_ binary private  */
-- 
1.9.1

